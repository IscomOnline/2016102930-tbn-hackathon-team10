var request = require('request');
var cheerio = require('cheerio');
var mysql = require('mysql');

var connection = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: '',
  database: 'animal'
});

var birds = [
  "白頭翁",
  "小白鷺",
  "褐頭鷦鶯",
  "紅鳩",
  "洋燕",
  "綠繡眼",
  "珠頸斑鳩",
  "灰頭鷦鶯",
  "大卷尾",
  "斑文鳥",
  "夜鷺",
  "白鶺鴒",
  "灰樹鵲",
  "紅嘴黑鵯",
  "牛背鷺",
  "翠鳥",
  "小彎嘴",
  "家燕",
  "黑枕王鶲",
  "紅冠水雞",
  "麻雀",
  "小環頸鴴",
  "棕沙燕",
  "紅尾伯勞",
  "爪哇八哥",
  "棕扇尾鶯",
  "小雲雀",
  "棕背伯勞",
  "繡眼畫眉",
  "白環鸚嘴鵯",
  "山紅頭",
  "白腹秧雞",
  "粉紅鸚嘴",
  "五色鳥",
  "大冠鷲",
  "赤腰燕",
  "灰鶺鴒",
  "白腰文鳥",
  "棕三趾鶉",
  "番鵑",
  "金背鳩",
  "黃頭扇尾鶯",
  "蒼鷺",
  "黃鶺鴒",
  "頭烏線",
  "小卷尾",
  "竹雞",
  "小啄木",
  "野鴿",
  "巨嘴鴉",
  "黑臉鵐",
  "磯鷸",
  "黃尾鴝",
  "黃嘴角鴞",
  "東方環頸鴴",
  "喜鵲",
  "家八哥",
  "藍磯鶇",
  "烏頭翁",
  "青足鷸",
  "八哥",
  "鷹斑鷸",
  "斑嘴鴨",
  "燕鴴",
  "白腰草鷸",
  "鳳頭蒼鷹",
  "彩鷸",
  "大白鷺",
  "高蹺鴴",
  "紅隼",
  "黑頭文鳥",
  "翠翼鳩",
  "小鸊鷉",
  "黑冠麻鷺",
  "黃小鷺",
  "領角鴞",
  "紅喉歌鴝",
  "小水鴨",
  "畫眉",
  "棕面鶲鶯",
  "環頸雉",
  "赤胸鶇",
  "台灣藍鵲",
  "田鷸",
  "黃痣藪鶥",
  "中白鷺",
  "白耳奇鶥",
  "鉛色水鴝",
  "紅胸田雞",
  "河烏",
  "強腳樹鶯",
  "冠羽鳳鶥",
  "魚鷹",
  "綠鳩",
  "極北柳鶯",
  "台灣紫嘯鶇",
  "大彎嘴",
  "金斑鴴",
  "白腹鶇",
  "隼",
  "黑腹濱鷸",
  "山麻雀",
  "松雀鷹",
  "鸕鷀",
  "台灣山鷓鴣",
  "赤喉鷚",
  "朱鸝",
  "小燕鷗",
  "赤足鷸",
  "八色鳥",
  "綠畫眉",
  "黑翅鳶",
  "綠背山雀",
  "林鵰",
  "樹鷚",
  "白翅黑浮鷗",
  "綠頭鴨",
  "鐵嘴沙鴴",
  "小剪尾",
  "琵嘴鴨",
  "大花鷚",
  "池鷺",
  "赤腹鷹",
  "赤頸鴨",
  "紅嘴鷗",
  "紅尾鶇",
  "尖尾鴨",
  "灰椋鳥",
  "黃頭鶺鴒",
  "黑面琵鷺",
  "鷹鵑",
  "白尾鴝",
  "鵟",
  "斑紋鷦鶯",
  "小鵐",
  "白喉針尾雨燕",
  "澤蛙",
  "白眉鶇",
  "茅斑蝗鶯",
  "灰面鵟鷹",
  "日本松雀鷹",
  "赤腹山雀",
  "絲光椋鳥",
  "白眉鴨",
  "中杓鷸",
  "斑尾鷸",
  "翻石鷸",
  "白背鷚",
  "綠簑鷺",
  "唐白鷺",
  "埃及聖鹮",
  "橙頰梅花雀",
  "董雞",
  "黃山雀",
  "裏海燕鷗",
  "半蹼鷸",
  "藍腹鷴",
  "水雉",
  "黑尾鷸",
  "灰斑鴴",
  "黃喉鵐",
  "黑尾鷗",
  "燕鷗",
  "褐鷹鴞",
  "小杓鷸",
  "灰林鴿",
  "琵嘴鷸",
  "大麻鷺",
  "黃頸黑鷺",
  "花雀",
  "小杜鵑",
  "黑嘴鷗",
  "茶腹鳾",
  "紅領瓣足鷸",
  "短耳鴞",
  "岩鷺",
  "小濱鷸",
  "黑喉鴝",
  "蒼眉蝗鶯",
  "田鵐",
  "熊鷹",
  "諾氏鷸",
  "銹鵐",
  "紅尾鶲",
  "普通夜鷹",
  "海鷗",
  "黃鸝",
  "赤膀鴨",
  "鶴鷸",
  "黑頭翡翠",
  "長嘴半蹼鷸",
  "面天樹蛙",
  "流蘇鷸",
  "短翅樹鶯",
  "黃眉柳鶯"
];

for(i=0; i<birds.length; i++){
  var name = birds[i];
  request({
    url: 'https://zh.wikipedia.org/wiki/' + encodeURIComponent(birds[i]),
    method: 'GET'
  }, function (e, r, b) {
    if (e || !b) { return; }
    var $ = cheerio.load(b);
    var img = '';

    if ($($("div#mw-content-text table.infobox a.image img")).attr('src') != undefined){
      img = ($($("div#mw-content-text table.infobox a.image img")).attr('src')).split('//')[1]
    } else {
      img = null
    }

    var animal = {
      'name': $($("h1#firstHeading")).text(),
      'content': $($("div#mw-content-text p")).text(),
      'kingdom': $($("div#mw-content-text table.infobox table span.kingdom")).text(),
      'phylum': $($("div#mw-content-text table.infobox table span.phylum")).text(),
      'taxoclass': $($("div#mw-content-text table.infobox table span.taxoclass")).text(),
      'order': $($("div#mw-content-text table.infobox table span.order")).text(),
      'family': $($("div#mw-content-text table.infobox table span.family")).text(),
      'genus': $($("div#mw-content-text table.infobox table span.genus")).text(),
      'img': img
    }
    var query = connection.query('INSERT INTO animals SET ?', animal, function (err, result) {});
  });
}
